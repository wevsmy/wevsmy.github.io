---
title: Pythonè¿æ¥MySQLæ•°æ®åº“ä¹‹pymysqlæ¨¡å—ä½¿ç”¨
date: 2018-03-21 03:58:00
categories:
- ç¬”è®°
- åšå®¢å›­
tags:
- åšå®¢å›­
- æ¬å®¶
- cnblogs
---
# [è¿™æ˜¯ğŸ‘‰Pythonè¿æ¥MySQLæ•°æ®åº“ä¹‹pymysqlæ¨¡å—ä½¿ç”¨ğŸ‘ˆçš„æ‘˜è¦](/2018/03/21/cnblog_8616189/)
<!--more-->
# Python3è¿æ¥MySQL

æœ¬æ–‡ä»‹ç»Python3è¿æ¥MySQLçš„ç¬¬ä¸‰æ–¹åº“--PyMySQLçš„åŸºæœ¬ä½¿ç”¨ã€‚

## PyMySQLä»‹ç»

PyMySQL æ˜¯åœ¨ Python3.x ç‰ˆæœ¬ä¸­ç”¨äºè¿æ¥ MySQL æœåŠ¡å™¨çš„ä¸€ä¸ªåº“ï¼ŒPython2ä¸­åˆ™ä½¿ç”¨mysqldbã€‚

Djangoä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨PyMySQLè¿æ¥MySQLæ•°æ®åº“ã€‚

## PyMySQLå®‰è£…

    
    
    pip install pymysql

## è¿æ¥æ•°æ®åº“

### æ³¨æ„äº‹é¡¹

åœ¨è¿›è¡Œæœ¬æ–‡ä»¥ä¸‹å†…å®¹ä¹‹å‰éœ€è¦æ³¨æ„ï¼š

  * ä½ æœ‰ä¸€ä¸ªMySQLæ•°æ®åº“ï¼Œå¹¶ä¸”å·²ç»å¯åŠ¨ã€‚
  * ä½ æœ‰å¯ä»¥è¿æ¥è¯¥æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç 
  * ä½ æœ‰ä¸€ä¸ªæœ‰æƒé™æ“ä½œçš„database

### åŸºæœ¬ä½¿ç”¨

    
    
    # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    # å®šä¹‰è¦æ‰§è¡Œçš„SQLè¯­å¥
    sql = """
    CREATE TABLE USER1 (
    id INT auto_increment PRIMARY KEY ,
    name CHAR(10) NOT NULL UNIQUE,
    age TINYINT NOT NULL
    )ENGINE=innodb DEFAULT CHARSET=utf8;
    """
    # æ‰§è¡ŒSQLè¯­å¥
    cursor.execute(sql)
    # å…³é—­å…‰æ ‡å¯¹è±¡
    cursor.close()
    # å…³é—­æ•°æ®åº“è¿æ¥
    conn.close()

è¿”å›å­—å…¸æ ¼å¼æ•°æ®ï¼š

    
    
    # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥å¹¶ä¸”å°†ç»“æœä½œä¸ºå­—å…¸è¿”å›çš„æ¸¸æ ‡
    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)
    # å®šä¹‰è¦æ‰§è¡Œçš„SQLè¯­å¥
    sql = """
    CREATE TABLE USER1 (
    id INT auto_increment PRIMARY KEY ,
    name CHAR(10) NOT NULL UNIQUE,
    age TINYINT NOT NULL
    )ENGINE=innodb DEFAULT CHARSET=utf8;
    """
    # æ‰§è¡ŒSQLè¯­å¥
    cursor.execute(sql)
    # å…³é—­å…‰æ ‡å¯¹è±¡
    cursor.close()
    # å…³é—­æ•°æ®åº“è¿æ¥
    conn.close()

æ³¨æ„ï¼š

charset="utf8"ï¼Œç¼–ç ä¸è¦å†™æˆ"utf-8"

## å¢åˆ æ”¹æŸ¥æ“ä½œ

### å¢

    
    
    # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    sql = "INSERT INTO USER1(name, age) VALUES (%s, %s);"
    username = "Alex"
    age = 18
    # æ‰§è¡ŒSQLè¯­å¥
    cursor.execute(sql, [username, age])
    # æäº¤äº‹åŠ¡
    conn.commit()
    cursor.close()
    conn.close()

**æ’å…¥æ•°æ®å¤±è´¥å›æ»š**

    
    
     # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    sql = "INSERT INTO USER1(name, age) VALUES (%s, %s);"
    username = "Alex"
    age = 18
    try:
        # æ‰§è¡ŒSQLè¯­å¥
        cursor.execute(sql, [username, age])
        # æäº¤äº‹åŠ¡
        conn.commit()
    except Exception as e:
        # æœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        conn.rollback()
    cursor.close()
    conn.close()

**è·å–æ’å…¥æ•°æ®çš„ID(å…³è”æ“ä½œæ—¶ä¼šç”¨åˆ°)**

    
    
     # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    sql = "INSERT INTO USER1(name, age) VALUES (%s, %s);"
    username = "Alex"
    age = 18
    try:
        # æ‰§è¡ŒSQLè¯­å¥
        cursor.execute(sql, [username, age])
        # æäº¤äº‹åŠ¡
        conn.commit()
        # æäº¤ä¹‹åï¼Œè·å–åˆšæ’å…¥çš„æ•°æ®çš„ID
        last_id = cursor.lastrowid
    except Exception as e:
        # æœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        conn.rollback()
    cursor.close()
    conn.close()

**æ‰¹é‡æ‰§è¡Œ**

    
    
     # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    sql = "INSERT INTO USER1(name, age) VALUES (%s, %s);"
    data = [("Alex", 18), ("Egon", 20), ("Yuan", 21)]
    try:
        # æ‰¹é‡æ‰§è¡Œå¤šæ¡æ’å…¥SQLè¯­å¥
        cursor.executemany(sql, data)
        # æäº¤äº‹åŠ¡
        conn.commit()
    except Exception as e:
        # æœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        conn.rollback()
    cursor.close()
    conn.close()

### åˆ 

    
    
    # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    sql = "DELETE FROM USER1 WHERE id=%s;"
    try:
        cursor.execute(sql, [4])
        # æäº¤äº‹åŠ¡
        conn.commit()
    except Exception as e:
        # æœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        conn.rollback()
    cursor.close()
    conn.close()

### æ”¹

    
    
    # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    # ä¿®æ”¹æ•°æ®çš„SQLè¯­å¥
    sql = "UPDATE USER1 SET age=%s WHERE name=%s;"
    username = "Alex"
    age = 80
    try:
        # æ‰§è¡ŒSQLè¯­å¥
        cursor.execute(sql, [age, username])
        # æäº¤äº‹åŠ¡
        conn.commit()
    except Exception as e:
        # æœ‰å¼‚å¸¸ï¼Œå›æ»šäº‹åŠ¡
        conn.rollback()
    cursor.close()
    conn.close()



### æŸ¥

**æŸ¥è¯¢å•æ¡æ•°æ®**

    
    
     # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    # æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥
    sql = "SELECT id,name,age from USER1 WHERE id=1;"
    # æ‰§è¡ŒSQLè¯­å¥
    cursor.execute(sql)
    # è·å–å•æ¡æŸ¥è¯¢æ•°æ®
    ret = cursor.fetchone()
    cursor.close()
    conn.close()
    # æ‰“å°ä¸‹æŸ¥è¯¢ç»“æœ
    print(ret)

**æŸ¥è¯¢å¤šæ¡æ•°æ®**

    
    
     # å¯¼å…¥pymysqlæ¨¡å—
    import pymysql
    # è¿æ¥database
    conn = pymysql.connect(host="ä½ çš„æ•°æ®åº“åœ°å€", user="ç”¨æˆ·å",password="å¯†ç ",database="æ•°æ®åº“å",charset="utf8")
    # å¾—åˆ°ä¸€ä¸ªå¯ä»¥æ‰§è¡ŒSQLè¯­å¥çš„å…‰æ ‡å¯¹è±¡
    cursor = conn.cursor()
    # æŸ¥è¯¢æ•°æ®çš„SQLè¯­å¥
    sql = "SELECT id,name,age from USER1;"
    # æ‰§è¡ŒSQLè¯­å¥
    cursor.execute(sql)
    # è·å–å¤šæ¡æŸ¥è¯¢æ•°æ®
    ret = cursor.fetchall()
    cursor.close()
    conn.close()
    # æ‰“å°ä¸‹æŸ¥è¯¢ç»“æœ
    print(ret)

##  è¿›é˜¶ç”¨æ³•

    
    
    # å¯ä»¥è·å–æŒ‡å®šæ•°é‡çš„æ•°æ®
    cursor.fetchmany(3)
    # å…‰æ ‡æŒ‰ç»å¯¹ä½ç½®ç§»åŠ¨1
    cursor.scroll(1, mode="absolute")
    # å…‰æ ‡æŒ‰ç…§ç›¸å¯¹ä½ç½®(å½“å‰ä½ç½®)ç§»åŠ¨1
    cursor.scroll(1, mode="relative")










