---
title: python loggingæ¨¡å—
date: 2018-01-24 08:29:00
categories:
- ç¬”è®°
- åšå®¢å›­
tags:
- åšå®¢å›­
- æ¬å®¶
- cnblogs
---
# [è¿™æ˜¯ğŸ‘‰python loggingæ¨¡å—ğŸ‘ˆçš„æ‘˜è¦](/2018/01/24/cnblog_8342302/)
<!--more-->
### å‡½æ•°å¼ç®€å•é…ç½®

    
    
    import logging  
    logging.debug('debug message')  
    logging.info('info message')  
    logging.warning('warning message')  
    logging.error('error message')  
    logging.critical('critical message') 

é»˜è®¤æƒ…å†µä¸‹Pythonçš„loggingæ¨¡å—å°†æ—¥å¿—æ‰“å°åˆ°äº†æ ‡å‡†è¾“å‡ºä¸­ï¼Œä¸”åªæ˜¾ç¤ºäº†å¤§äºç­‰äºWARNINGçº§åˆ«çš„æ—¥å¿—ï¼Œè¿™è¯´æ˜é»˜è®¤çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºWARNINGï¼ˆæ—¥å¿—çº§åˆ«ç­‰çº§CRITICAL
> ERROR > WARNING > INFO > DEBUGï¼‰ï¼Œé»˜è®¤çš„æ—¥å¿—æ ¼å¼ä¸ºæ—¥å¿—çº§åˆ«ï¼šLoggeråç§°ï¼šç”¨æˆ·è¾“å‡ºæ¶ˆæ¯ã€‚

**çµæ´»é…ç½®æ—¥å¿—çº§åˆ«ï¼Œæ—¥å¿—æ ¼å¼ï¼Œè¾“å‡ºä½ç½®:**

    
    
     import logging  
    logging.basicConfig(level=logging.DEBUG,  
                        format='%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s',  
                        datefmt='%a, %d %b %Y %H:%M:%S',  
                        filename='/tmp/test.log',  
                        filemode='w')  
      
    logging.debug('debug message')  
    logging.info('info message')  
    logging.warning('warning message')  
    logging.error('error message')  
    logging.critical('critical message')

é…ç½®å‚æ•°ï¼š

    
    
    logging.basicConfig()å‡½æ•°ä¸­å¯é€šè¿‡å…·ä½“å‚æ•°æ¥æ›´æ”¹loggingæ¨¡å—é»˜è®¤è¡Œä¸ºï¼Œå¯ç”¨å‚æ•°æœ‰ï¼š
    
    filenameï¼šç”¨æŒ‡å®šçš„æ–‡ä»¶ååˆ›å»ºFiledHandlerï¼Œè¿™æ ·æ—¥å¿—ä¼šè¢«å­˜å‚¨åœ¨æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚
    filemodeï¼šæ–‡ä»¶æ‰“å¼€æ–¹å¼ï¼Œåœ¨æŒ‡å®šäº†filenameæ—¶ä½¿ç”¨è¿™ä¸ªå‚æ•°ï¼Œé»˜è®¤å€¼ä¸º"a"è¿˜å¯æŒ‡å®šä¸º"w"ã€‚
    formatï¼šæŒ‡å®šhandlerä½¿ç”¨çš„æ—¥å¿—æ˜¾ç¤ºæ ¼å¼ã€‚
    datefmtï¼šæŒ‡å®šæ—¥æœŸæ—¶é—´æ ¼å¼ã€‚
    levelï¼šè®¾ç½®rootloggerï¼ˆåè¾¹ä¼šè®²è§£å…·ä½“æ¦‚å¿µï¼‰çš„æ—¥å¿—çº§åˆ«
    streamï¼šç”¨æŒ‡å®šçš„streamåˆ›å»ºStreamHandlerã€‚å¯ä»¥æŒ‡å®šè¾“å‡ºåˆ°sys.stderr,sys.stdoutæˆ–è€…æ–‡ä»¶(f=open('test.log','w'))ï¼Œé»˜è®¤ä¸ºsys.stderrã€‚è‹¥åŒæ—¶åˆ—å‡ºäº†filenameå’Œstreamä¸¤ä¸ªå‚æ•°ï¼Œåˆ™streamå‚æ•°ä¼šè¢«å¿½ç•¥ã€‚
    
    formatå‚æ•°ä¸­å¯èƒ½ç”¨åˆ°çš„æ ¼å¼åŒ–ä¸²ï¼š
    %(name)s Loggerçš„åå­—
    %(levelno)s æ•°å­—å½¢å¼çš„æ—¥å¿—çº§åˆ«
    %(levelname)s æ–‡æœ¬å½¢å¼çš„æ—¥å¿—çº§åˆ«
    %(pathname)s è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„æ¨¡å—çš„å®Œæ•´è·¯å¾„åï¼Œå¯èƒ½æ²¡æœ‰
    %(filename)s è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„æ¨¡å—çš„æ–‡ä»¶å
    %(module)s è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„æ¨¡å—å
    %(funcName)s è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„å‡½æ•°å
    %(lineno)d è°ƒç”¨æ—¥å¿—è¾“å‡ºå‡½æ•°çš„è¯­å¥æ‰€åœ¨çš„ä»£ç è¡Œ
    %(created)f å½“å‰æ—¶é—´ï¼Œç”¨UNIXæ ‡å‡†çš„è¡¨ç¤ºæ—¶é—´çš„æµ® ç‚¹æ•°è¡¨ç¤º
    %(relativeCreated)d è¾“å‡ºæ—¥å¿—ä¿¡æ¯æ—¶çš„ï¼Œè‡ªLoggeråˆ›å»ºä»¥ æ¥çš„æ¯«ç§’æ•°
    %(asctime)s å­—ç¬¦ä¸²å½¢å¼çš„å½“å‰æ—¶é—´ã€‚é»˜è®¤æ ¼å¼æ˜¯ "2003-07-08 16:49:45,896"ã€‚é€—å·åé¢çš„æ˜¯æ¯«ç§’
    %(thread)d çº¿ç¨‹IDã€‚å¯èƒ½æ²¡æœ‰
    %(threadName)s çº¿ç¨‹åã€‚å¯èƒ½æ²¡æœ‰
    %(process)d è¿›ç¨‹IDã€‚å¯èƒ½æ²¡æœ‰
    %(message)sç”¨æˆ·è¾“å‡ºçš„æ¶ˆæ¯

### loggerå¯¹è±¡é…ç½®

    
    
    import logging
    
    logger = logging.getLogger()
    # åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºå†™å…¥æ—¥å¿—æ–‡ä»¶
    fh = logging.FileHandler('test.log',encoding='utf-8') 
    
    # å†åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºè¾“å‡ºåˆ°æ§åˆ¶å° 
    ch = logging.StreamHandler() 
    formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    fh.setLevel(logging.DEBUG)
    
    fh.setFormatter(formatter) 
    ch.setFormatter(formatter) 
    logger.addHandler(fh) #loggerå¯¹è±¡å¯ä»¥æ·»åŠ å¤šä¸ªfhå’Œchå¯¹è±¡ 
    logger.addHandler(ch) 
    
    logger.debug('logger debug message') 
    logger.info('logger info message') 
    logger.warning('logger warning message') 
    logger.error('logger error message') 
    logger.critical('logger critical message')

loggingåº“æä¾›äº†å¤šä¸ªç»„ä»¶ï¼šLoggerã€Handlerã€Filterã€Formatterã€‚Loggerå¯¹è±¡æä¾›åº”ç”¨ç¨‹åºå¯ç›´æ¥ä½¿ç”¨çš„æ¥å£ï¼ŒHandlerå‘é€æ—¥å¿—åˆ°é€‚å½“çš„ç›®çš„åœ°ï¼ŒFilteræä¾›äº†è¿‡æ»¤æ—¥å¿—ä¿¡æ¯çš„æ–¹æ³•ï¼ŒFormatteræŒ‡å®šæ—¥å¿—æ˜¾ç¤ºæ ¼å¼ã€‚å¦å¤–ï¼Œå¯ä»¥é€šè¿‡ï¼šlogger.setLevel(logging.Debug)è®¾ç½®çº§åˆ«,å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡

fh.setLevel(logging.Debug)å•å¯¹æ–‡ä»¶æµè®¾ç½®æŸä¸ªçº§åˆ«ã€‚

### å­—å…¸é…ç½®æ³•ï¼š

    
    
    import os
    import logging.config
    
    
    # è®°å½•æ–‡ä»¶æ—¥å¿—è¾“å‡ºçš„æ ¼å¼
    standard_format = '[%(asctime)s][%(threadName)s:%(thread)d][task_id:%(name)s][%(filename)s:%(lineno)d]' \
                      '[%(levelname)s][%(message)s]' #å…¶ä¸­nameä¸ºgetloggeræŒ‡å®šçš„åå­—
    # ç»ˆç«¯æ—¥å¿—è¾“å‡ºçš„æ ¼å¼
    simple_format = '%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s:%(message)s'
    
    
    logfile_dir = r'%s\log' %os.path.dirname(os.path.dirname(os.path.abspath(__file__)))  # logæ–‡ä»¶çš„ç›®å½•
    
    logfile_name = 'log.log'  # logæ–‡ä»¶å
    
    # å¦‚æœä¸å­˜åœ¨å®šä¹‰çš„æ—¥å¿—ç›®å½•å°±åˆ›å»ºä¸€ä¸ª
    if not os.path.isdir(logfile_dir):
        os.mkdir(logfile_dir)
    
    # logæ–‡ä»¶çš„å…¨è·¯å¾„
    logfile_path = os.path.join(logfile_dir, logfile_name)
    
    # logé…ç½®å­—å…¸
    LOGGING_DIC = {
        'version': 1,
        'disable_existing_loggers': False,
        'formatters': {
            'standard': {
                'format': standard_format
            },
            'simple': {
                'format': simple_format
            },
        },
        'filters': {},
        'handlers': {
            #æ‰“å°åˆ°ç»ˆç«¯çš„æ—¥å¿—
            'console': {
                'level': 'DEBUG',
                'class': 'logging.StreamHandler',  # æ‰“å°åˆ°å±å¹•
                'formatter': 'simple'
            },
            #æ‰“å°åˆ°æ–‡ä»¶çš„æ—¥å¿—,æ”¶é›†infoåŠä»¥ä¸Šçš„æ—¥å¿—
            'default': {
                'level': 'DEBUG',
                'class': 'logging.handlers.RotatingFileHandler',  # ä¿å­˜åˆ°æ–‡ä»¶
                'formatter': 'standard',
                'filename': logfile_path,  # æ—¥å¿—æ–‡ä»¶
                'maxBytes': 1024*1024*5,  # æ—¥å¿—å¤§å° 5M
                'backupCount': 5,
                'encoding': 'utf-8',  # æ—¥å¿—æ–‡ä»¶çš„ç¼–ç ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒä¸­æ–‡logä¹±ç äº†
            },
        },
        'loggers': {
            #logging.getLogger(__name__)æ‹¿åˆ°çš„loggeré…ç½®
            '': {
                'handlers': ['default', 'console'],  # è¿™é‡ŒæŠŠä¸Šé¢å®šä¹‰çš„ä¸¤ä¸ªhandleréƒ½åŠ ä¸Šï¼Œå³logæ•°æ®æ—¢å†™å…¥æ–‡ä»¶åˆæ‰“å°åˆ°å±å¹•
                'level': 'DEBUG',
                'propagate': True,  # å‘ä¸Šï¼ˆæ›´é«˜levelçš„loggerï¼‰ä¼ é€’
            },
        },
    }
    
    def load_my_logging_cfg():
        logging.config.dictConfig(LOGGING_DIC)  # å¯¼å…¥ä¸Šé¢å®šä¹‰çš„loggingé…ç½®
    
    if __name__ == '__main__':
        load_my_logging_cfg()
        logger = logging.getLogger(__name__)  # ç”Ÿæˆä¸€ä¸ªlogå®ä¾‹
        logger.info('info message')
        logger.debug('debug message')
        logger.warning('warning message')
        logger.error('error message')
        logger.critical('critical message')




