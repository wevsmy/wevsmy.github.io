---
title: python é¢å‘å¯¹è±¡è¿›é˜¶ä¹‹å¯¹è±¡å†…ç½®æ–¹æ³•
date: 2018-01-22 08:17:00
categories:
- ç¬”è®°
- åšå®¢å›­
tags:
- åšå®¢å›­
- æ¬å®¶
- cnblogs
---
# [è¿™æ˜¯ğŸ‘‰python é¢å‘å¯¹è±¡è¿›é˜¶ä¹‹å¯¹è±¡å†…ç½®æ–¹æ³•ğŸ‘ˆçš„æ‘˜è¦](/2018/01/22/cnblog_8329568/)
<!--more-->
# åå°„ç›¸å…³

![](http://images2017.cnblogs.com/blog/1301576/201801/1301576-20180122191244381-564997212.png)

å¸¸ç”¨çš„å°±æ˜¯hasattr,getattr

    
    
    class A():
        def __init__(self):
            pass
        def func(self):
            print("func")
    
    a = A()
    a.name = "123"
    a.age = 123
    print(getattr(a,"name"))
    getattr(a, "func")()
    print(hasattr(a, "ame"))

 setattr,delattrï¼Œç”¨äºè®¾ç½®å˜é‡å’Œåˆ é™¤å˜é‡ï¼Œä¸å¸¸ç”¨

 ç”¨äºå¯¹è±¡çš„ä¸€äº›å†…ç½®æ–¹æ³•ï¼š

# __str__

è°ƒç”¨å¯¹è±¡ï¼Œè‡ªåŠ¨è¾“å‡º

    
    
    class B:
    
        def __str__(self):
            return 'str : class B'
    
        def __repr__(self):
            return 'repr : class B'
    
    b = B()
    print('%s' % b)
    print('%r' % b)

# __getitem__, __setitem__, __delitem__

ç”¨äºç´¢å¼•æ“ä½œï¼Œå¦‚å­—å…¸ã€‚ä»¥ä¸Šåˆ†åˆ«è¡¨ç¤ºè·å–ã€è®¾ç½®ã€åˆ é™¤æ•°æ®

    
    
    class C(object):  
    
        def __init__(self):
            self.value = {}
            self.name = 'test'
        def __getitem__(self, item):
            print '__getitem__', item
            return self.value[item]
        def __setitem__(self, key, value):
            print '__setitem__', key, value
            self.value[key] = value
        def __delitem__(self, key):
            print '__delitem__', key
            del self.value[key]
        def __len__(self):
            return len(self.value)
    
    print C.__doc__
    
    c = C()
    #print c
    #result = c['k1']
    c['k2'] = 5
    c['k1'] = "Hello"
    print c['k2']
    print len(c)

# __call__

å¯¹è±¡åé¢åŠ æ‹¬å·ï¼Œè§¦å‘æ‰§è¡Œã€‚

æ³¨ï¼šæ„é€ æ–¹æ³•çš„æ‰§è¡Œæ˜¯ç”±åˆ›å»ºå¯¹è±¡è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡ = ç±»å() ï¼›è€Œå¯¹äº __call__ æ–¹æ³•çš„æ‰§è¡Œæ˜¯ç”±å¯¹è±¡ååŠ æ‹¬å·è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡() æˆ–è€… ç±»()()

    
    
    class Foo:
    
        def __init__(self):
            pass
        
        def __call__(self, *args, **kwargs):
    
            print('__call__')
    
    
    obj = Foo() # æ‰§è¡Œ __init__
    obj()       # æ‰§è¡Œ __call__

# __hash__

å¤–éƒ¨å“ˆå¸Œï¼Œä¾èµ–ä¸å†…ç½®__hash__æ–¹æ³•

    
    
    class A():
        def __init__(self):
            self.a = 1
            self.b = 2
    
        def __hash__(self):
            return hash(str(self.a)+str(self.b))
    a = A()
    print(hash(a))

# __eq__æ–¹æ³•

ç”¨ä¸åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå› ä¸º == é»˜è®¤æ˜¯æ¯”è¾ƒå†…å­˜åœ°å€

    
    
    class A():
        def __init__(self, name):
            self.name = name
    
        def __eq__(self, other):
            if (self.__dict__ == other.__dict__):
                return True
    
    a = A("test")
    b = A("test")
    print(a == b)

# setï¼ˆï¼‰å¯¹è±¡å»é‡ï¼Œä¾èµ–äºhashï¼Œeqæ–¹æ³•

    
    
    class Person:
        def __init__(self,name,age,sex):
            self.name = name
            self.age = age
            self.sex = sex
    
        def __hash__(self):
            return hash(self.name+self.sex)
    
        def __eq__(self, other):
            if self.name == other.name and self.sex == other.sex:return True
    
    p_lst = []
    for i in range(84):
        p_lst.append(Person('egon',i,'male'))
    
    print(p_lst)
    print(set(p_lst))

# `__del__()`æ–¹æ³•

åˆ›å»ºå¯¹è±¡åï¼Œpythonè§£é‡Šå™¨é»˜è®¤è°ƒç”¨`__init__()`æ–¹æ³•ï¼›

å½“åˆ é™¤ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œpythonè§£é‡Šå™¨ä¹Ÿä¼šé»˜è®¤è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸º`__del__()`æ–¹æ³•

    
    
    import time
    class Animal(object):
        # åˆå§‹åŒ–æ–¹æ³•
        # åˆ›å»ºå®Œå¯¹è±¡åä¼šè‡ªåŠ¨è¢«è°ƒç”¨
        def __init__(self, name):
            print('__init__æ–¹æ³•è¢«è°ƒç”¨')
            self.__name = name
        # ææ„æ–¹æ³•
        # å½“å¯¹è±¡è¢«åˆ é™¤æ—¶ï¼Œä¼šè‡ªåŠ¨è¢«è°ƒç”¨
        def __del__(self):
            print("__del__æ–¹æ³•è¢«è°ƒç”¨")
            print("%så¯¹è±¡é©¬ä¸Šè¢«å¹²æ‰äº†..."%self.__name)
    # åˆ›å»ºå¯¹è±¡
    dog = Animal("å“ˆçš®ç‹—")
    # åˆ é™¤å¯¹è±¡
    del dog
    cat = Animal("æ³¢æ–¯çŒ«")
    cat2 = cat
    cat3 = cat
    print("---é©¬ä¸Š åˆ é™¤catå¯¹è±¡")
    del cat
    print("---é©¬ä¸Š åˆ é™¤cat2å¯¹è±¡")
    del cat2
    print("---é©¬ä¸Š åˆ é™¤cat3å¯¹è±¡")
    del cat3
    print("ç¨‹åº2ç§’é’Ÿåç»“æŸ")
    time.sleep(2)

#### ç»“æœï¼š

![](http://images2017.cnblogs.com/blog/1301576/201801/1301576-20180122193353975-1713486157.png)

#### æ€»ç»“

  * å½“æœ‰1ä¸ªå˜é‡ä¿å­˜äº†å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œæ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å°±ä¼šåŠ 1
  * å½“ä½¿ç”¨delåˆ é™¤å˜é‡æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸ä¼š1ï¼Œæ¯”å¦‚3ï¼Œé‚£ä¹ˆæ­¤æ—¶åªä¼šè®©è¿™ä¸ªå¼•ç”¨è®¡æ•°å‡1ï¼Œå³å˜ä¸º2ï¼Œå½“å†æ¬¡è°ƒç”¨delæ—¶ï¼Œå˜ä¸º1ï¼Œå¦‚æœå†è°ƒç”¨1æ¬¡delï¼Œæ­¤æ—¶ä¼šçœŸçš„æŠŠå¯¹è±¡è¿›è¡Œåˆ é™¤

# __slots__

ç°åœ¨æˆ‘ä»¬ç»ˆäºæ˜ç™½äº†ï¼ŒåŠ¨æ€è¯­è¨€ä¸é™æ€è¯­è¨€çš„ä¸åŒ

åŠ¨æ€è¯­è¨€ï¼šå¯ä»¥åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¿®æ”¹ä»£ç 

é™æ€è¯­è¨€ï¼šç¼–è¯‘æ—¶å·²ç»ç¡®å®šå¥½ä»£ç ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½ä¿®æ”¹

å¦‚æœæˆ‘ä»¬æƒ³è¦é™åˆ¶å®ä¾‹çš„å±æ€§æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚ï¼Œåªå…è®¸å¯¹Personå®ä¾‹æ·»åŠ nameå’Œageå±æ€§ã€‚

ä¸ºäº†è¾¾åˆ°é™åˆ¶çš„ç›®çš„ï¼ŒPythonå…è®¸åœ¨å®šä¹‰classçš„æ—¶å€™ï¼Œå®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„__slots__å˜é‡ï¼Œæ¥é™åˆ¶è¯¥classå®ä¾‹èƒ½æ·»åŠ çš„å±æ€§ï¼š

    
    
    >>> class Person(object):
        __slots__ = ("name", "age")
    
    >>> P = Person()
    >>> P.name = "è€ç‹"
    >>> P.age = 20
    >>> P.score = 100
    Traceback (most recent call last):
      File "<pyshell#3>", line 1, in <module>
    AttributeError: Person instance has no attribute 'score'
    >>>

#### æ³¨æ„:

  * ä½¿ç”¨__slots__è¦æ³¨æ„ï¼Œ__slots__å®šä¹‰çš„å±æ€§ä»…å¯¹å½“å‰ç±»å®ä¾‹èµ·ä½œç”¨ï¼Œå¯¹ç»§æ‰¿çš„å­ç±»æ˜¯ä¸èµ·ä½œç”¨çš„

    
    
    In [67]: class Test(Person):
        ...:     pass
        ...:
    
    In [68]: t = Test()
    
    In [69]: t.score = 100


