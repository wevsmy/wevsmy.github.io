---
title: DjangoåŸºç¡€01
date: 2018-03-22 01:17:00
categories:
- ç¬”è®°
- åšå®¢å›­
tags:
- åšå®¢å›­
- æ¬å®¶
- cnblogs
---
# [è¿™æ˜¯ğŸ‘‰DjangoåŸºç¡€01ğŸ‘ˆçš„æ‘˜è¦](/2018/03/22/cnblog_8621513/)
<!--more-->
# Webæ¡†æ¶æœ¬è´¨

æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼šæ‰€æœ‰çš„Webåº”ç”¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªsocketæœåŠ¡ç«¯ï¼Œè€Œç”¨æˆ·çš„æµè§ˆå™¨å°±æ˜¯ä¸€ä¸ªsocketå®¢æˆ·ç«¯ã€‚ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è‡ªå·±å®ç°Webæ¡†æ¶äº†ã€‚


```python
	import socket

    sk = socket.socket()
    sk.bind(("127.0.0.1", 80))
    sk.listen(5)

	while True:
		conn, addr = sk.accept()
		data = conn.recv(8096)
		conn.send(b"OK")
		conn.close()
```
å¯ä»¥è¯´WebæœåŠ¡æœ¬è´¨ä¸Šéƒ½æ˜¯åœ¨è¿™åå‡ è¡Œä»£ç åŸºç¡€ä¸Šæ‰©å±•å‡ºæ¥çš„ã€‚è¿™æ®µä»£ç å°±æ˜¯å®ƒä»¬çš„ç¥–å®—ã€‚

ç”¨æˆ·çš„æµè§ˆå™¨ä¸€è¾“å…¥ç½‘å€ï¼Œä¼šç»™æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œé‚£æµè§ˆå™¨ä¼šå‘é€ä»€ä¹ˆæ•°æ®ï¼Ÿæ€ä¹ˆå‘ï¼Ÿè¿™ä¸ªè°æ¥å®šï¼Ÿ ä½ è¿™ä¸ªç½‘ç«™æ˜¯è¿™ä¸ªè§„å®šï¼Œä»–é‚£ä¸ªç½‘ç«™æŒ‰ç…§ä»–é‚£ä¸ªè§„å®šï¼Œè¿™äº’è”ç½‘è¿˜èƒ½ç©ä¹ˆï¼Ÿ

æ‰€ä»¥ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªç»Ÿä¸€çš„è§„åˆ™ï¼Œè®©å¤§å®¶å‘é€æ¶ˆæ¯ã€æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™æœ‰ä¸ªæ ¼å¼ä¾æ®ï¼Œä¸èƒ½éšä¾¿å†™ã€‚

è¿™ä¸ªè§„åˆ™å°±æ˜¯HTTPåè®®ï¼Œä»¥åæµè§ˆå™¨å‘é€è¯·æ±‚ä¿¡æ¯ä¹Ÿå¥½ï¼ŒæœåŠ¡å™¨å›å¤å“åº”ä¿¡æ¯ä¹Ÿç½¢ï¼Œéƒ½è¦æŒ‰ç…§è¿™ä¸ªè§„åˆ™æ¥ã€‚

HTTPåè®®ä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé‚£HTTPåè®®æ˜¯æ€ä¹ˆè§„å®šæ¶ˆæ¯æ ¼å¼çš„å‘¢ï¼Ÿ

è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹æˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ä»€ä¹ˆã€‚

ç„¶åå†çœ‹ä¸‹æˆ‘ä»¬æµè§ˆå™¨æ”¶åˆ°çš„å“åº”ä¿¡æ¯æ˜¯ä»€ä¹ˆã€‚

å“åº”å¤´åœ¨æµè§ˆå™¨çš„networkçª—å£å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„HTMLé¡µé¢å†…å®¹å°±æ˜¯å“åº”ä½“ã€‚æœ¬è´¨ä¸Šè¿˜æ˜¯å­—ç¬¦ä¸²ï¼Œå› ä¸ºæµè§ˆå™¨è®¤è¯†HTMLï¼Œæ‰€ä»¥æ‰ä¼šæ¸²æŸ“å‡ºé¡µé¢ã€‚

[HTTPåè®®ä»‹ç»](http://www.cnblogs.com/liwenzhou/articles/8620663.html)

æ¯ä¸ªHTTPè¯·æ±‚å’Œå“åº”éƒ½éµå¾ªç›¸åŒçš„æ ¼å¼ï¼Œä¸€ä¸ªHTTPåŒ…å«Headerå’ŒBodyä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­Bodyæ˜¯å¯é€‰çš„ã€‚ HTTPå“åº”çš„Headerä¸­æœ‰ä¸€ä¸ª
`Content-Type`è¡¨æ˜å“åº”çš„å†…å®¹æ ¼å¼ã€‚å¦‚ `text/html`è¡¨ç¤ºHTMLç½‘é¡µã€‚

HTTP GETè¯·æ±‚çš„æ ¼å¼ï¼š


â€‹    
â€‹    GET /path HTTP/1.1
â€‹    header1:v1\r\n
â€‹    header2:v2\r\n

ä½¿ç”¨ `\r\n`åˆ†éš”å¤šä¸ªheader

HTTP POSTè¯·æ±‚æ ¼å¼ï¼š


â€‹    
â€‹    POST /path HTTP/1.1
â€‹    header1:v1\r\n
â€‹    header2:v2\r\n
â€‹    \r\n\r\n
â€‹    è¯·æ±‚ä½“...

å½“é‡åˆ°è¿ç»­ä¸¤ä¸ª `\r\n\r\n`æ—¶ï¼Œè¡¨ç¤ºHeaderéƒ¨åˆ†ç»“æŸäº†ï¼Œåé¢çš„æ•°æ®æ˜¯Bodyã€‚

HTTPå“åº”çš„æ ¼å¼ï¼š


â€‹    
â€‹    200 OK
â€‹    Header1:v1\r\n
â€‹    Header2:v2\r\n
â€‹    \r\n\r\n
â€‹    å“åº”ä½“...

è®©æˆ‘ä»¬çš„Webæ¡†æ¶åœ¨ç»™å®¢æˆ·ç«¯å›å¤å“åº”çš„æ—¶å€™æŒ‰ç…§HTTPåè®®çš„è§„åˆ™åŠ ä¸Šå“åº”å¤´ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªæ­£ç»çš„Webæ¡†æ¶äº†ã€‚


```python
	import socket

	sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	sock.bind(('127.0.0.1', 8000))
	sock.listen(5)
	
	while True:
		conn, addr = sock.accept()
		data = conn.recv(8096)
		conn.send(b"HTTP/1.1 200 OK\r\n\r\n")
		conn.send(b"OK")
		conn.close()
```
ä¸Šè¿°é€šè¿‡socketæ¥å®ç°äº†å…¶æœ¬è´¨ã€‚

å¯¹äºçœŸå®å¼€å‘ä¸­çš„python webç¨‹åºæ¥è¯´ï¼Œä¸€èˆ¬ä¼šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæœåŠ¡å™¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºã€‚

æœåŠ¡å™¨ç¨‹åºè´Ÿè´£å¯¹socketæœåŠ¡å™¨è¿›è¡Œå°è£…ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¯¹è¯·æ±‚çš„å„ç§æ•°æ®è¿›è¡Œæ•´ç†ã€‚

åº”ç”¨ç¨‹åºåˆ™è´Ÿè´£å…·ä½“çš„é€»è¾‘å¤„ç†ã€‚ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œå°±å‡ºç°äº†ä¼—å¤šçš„Webæ¡†æ¶ï¼Œä¾‹å¦‚ï¼šDjangoã€Flaskã€web.py
ç­‰ã€‚ä¸åŒçš„æ¡†æ¶æœ‰ä¸åŒçš„å¼€å‘æ–¹å¼ï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œå¼€å‘å‡ºçš„åº”ç”¨ç¨‹åºéƒ½è¦å’ŒæœåŠ¡å™¨ç¨‹åºé…åˆï¼Œæ‰èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚

è¿™æ ·ï¼ŒæœåŠ¡å™¨ç¨‹åºå°±éœ€è¦ä¸ºä¸åŒçš„æ¡†æ¶æä¾›ä¸åŒçš„æ”¯æŒã€‚è¿™æ ·æ··ä¹±çš„å±€é¢æ— è®ºå¯¹äºæœåŠ¡å™¨è¿˜æ˜¯æ¡†æ¶ï¼Œéƒ½æ˜¯ä¸å¥½çš„ã€‚å¯¹æœåŠ¡å™¨æ¥è¯´ï¼Œéœ€è¦æ”¯æŒå„ç§ä¸åŒæ¡†æ¶ï¼Œå¯¹æ¡†æ¶æ¥è¯´ï¼Œåªæœ‰æ”¯æŒå®ƒçš„æœåŠ¡å™¨æ‰èƒ½è¢«å¼€å‘å‡ºçš„åº”ç”¨ä½¿ç”¨ã€‚

è¿™æ—¶å€™ï¼Œæ ‡å‡†åŒ–å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç«‹ä¸€ä¸ªæ ‡å‡†ï¼Œåªè¦æœåŠ¡å™¨ç¨‹åºæ”¯æŒè¿™ä¸ªæ ‡å‡†ï¼Œæ¡†æ¶ä¹Ÿæ”¯æŒè¿™ä¸ªæ ‡å‡†ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¯ä»¥é…åˆä½¿ç”¨ã€‚ä¸€æ—¦æ ‡å‡†ç¡®å®šï¼ŒåŒæ–¹å„è‡ªå®ç°ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨å¯ä»¥æ”¯æŒæ›´å¤šæ”¯æŒæ ‡å‡†çš„æ¡†æ¶ï¼Œæ¡†æ¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´å¤šæ”¯æŒæ ‡å‡†çš„æœåŠ¡å™¨ã€‚

WSGIï¼ˆWeb Server Gateway
Interfaceï¼‰å°±æ˜¯ä¸€ç§è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨Pythonç¼–å†™çš„webåº”ç”¨ç¨‹åºä¸webæœåŠ¡å™¨ç¨‹åºä¹‹é—´çš„æ¥å£æ ¼å¼ï¼Œå®ç°webåº”ç”¨ç¨‹åºä¸webæœåŠ¡å™¨ç¨‹åºé—´çš„è§£è€¦ã€‚

å¸¸ç”¨çš„WSGIæœåŠ¡å™¨æœ‰uwsgiã€Gunicornã€‚è€ŒPythonæ ‡å‡†åº“æä¾›çš„ç‹¬ç«‹WSGIæœåŠ¡å™¨å«wsgirefï¼ŒDjangoå¼€å‘ç¯å¢ƒç”¨çš„å°±æ˜¯è¿™ä¸ªæ¨¡å—æ¥åšæœåŠ¡å™¨ã€‚


â€‹    
â€‹    from wsgiref.simple_server import make_server


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8')])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        return [bytes("<h1>Hello world!</h1>", encoding="utf8"),]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

è¿™æ ·å°±ç»“æŸäº†å—ï¼Ÿ å¦‚ä½•è®©æˆ‘ä»¬çš„WebæœåŠ¡æ ¹æ®ç”¨æˆ·è¯·æ±‚çš„URLä¸åŒè€Œè¿”å›ä¸åŒçš„å†…å®¹å‘¢ï¼Ÿ

å°äº‹ä¸€æ¡©ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¯·æ±‚ç›¸å…³æ•°æ®é‡Œé¢æ‹¿åˆ°è¯·æ±‚çš„URLï¼Œç„¶ååšä¸€ä¸ªåˆ¤æ–­ã€‚


â€‹    
â€‹    from wsgiref.simple_server import make_server


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8'), ])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        url = environ['PATH_INFO']  # å–åˆ°ç”¨æˆ·è¾“å…¥çš„url
â€‹        if url == "/index/":
â€‹            return [bytes("<h1>è¿™æ˜¯indexé¡µé¢</h1>", encoding="utf8"), ]
â€‹        elif url == "/home/":
â€‹            return [bytes("<h1>è¿™æ˜¯homeé¡µé¢</h1>", encoding="utf8"), ]
â€‹        else:
â€‹            return [bytes("404æ²¡æœ‰è¯¥é¡µé¢", encoding="utf8"), ]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

è§£å†³äº†ä¸åŒURLè¿”å›ä¸åŒå†…å®¹çš„éœ€æ±‚ã€‚ ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œå¦‚æœæœ‰å¾ˆå¤šå¾ˆå¤šé¡µé¢æ€ä¹ˆåŠï¼Ÿéš¾é“è¦æŒ¨ä¸ªåˆ¤æ–­ï¼Ÿ å½“ç„¶ä¸ç”¨ï¼Œæˆ‘ä»¬æœ‰æ›´èªæ˜çš„åŠæ³•ã€‚


â€‹    
â€‹    from wsgiref.simple_server import make_server


â€‹    
â€‹    def index():
â€‹        return [bytes("<h1>è¿™æ˜¯indexé¡µé¢</h1>", encoding="utf8"), ]


â€‹    
â€‹    def home():
â€‹        return [bytes("<h1>è¿™æ˜¯homeé¡µé¢</h1>", encoding="utf8"), ]


â€‹    
â€‹    # å®šä¹‰ä¸€ä¸ªurlå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»
â€‹    URL_LIST = [
â€‹        ("/index/", index),
â€‹        ("/home/", home),
â€‹    ]


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8'), ])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        url = environ['PATH_INFO']  # å–åˆ°ç”¨æˆ·è¾“å…¥çš„url
â€‹        func = None  # å°†è¦æ‰§è¡Œçš„å‡½æ•°
â€‹        for i in URL_LIST:
â€‹            if i[0] == url:
â€‹                func = i[1]  # å»ä¹‹å‰å®šä¹‰å¥½çš„urlåˆ—è¡¨é‡Œæ‰¾urlåº”è¯¥æ‰§è¡Œçš„å‡½æ•°
â€‹                break
â€‹        if func:  # å¦‚æœèƒ½æ‰¾åˆ°è¦æ‰§è¡Œçš„å‡½æ•°
â€‹            return func()  # è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœ
â€‹        else:
â€‹            return [bytes("404æ²¡æœ‰è¯¥é¡µé¢", encoding="utf8"), ]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

å®Œç¾è§£å†³äº†ä¸åŒURLè¿”å›ä¸åŒå†…å®¹çš„é—®é¢˜ã€‚ ä½†æ˜¯æˆ‘ä¸æƒ³ä»…ä»…è¿”å›å‡ ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ‘æƒ³ç»™æµè§ˆå™¨è¿”å›å®Œæ•´çš„HTMLå†…å®¹ï¼Œè¿™åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æ²¡é—®é¢˜ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œæœ€åéƒ½æ˜¯è½¬æ¢æˆå­—èŠ‚æ•°æ®å‘é€å‡ºå»çš„ã€‚ æˆ‘å¯ä»¥æ‰“å¼€HTMLæ–‡ä»¶ï¼Œè¯»å–å‡ºå®ƒå†…éƒ¨çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç„¶åå‘é€ç»™æµè§ˆå™¨ã€‚


â€‹    
â€‹    from wsgiref.simple_server import make_server


â€‹    
â€‹    def index():
â€‹        with open("index.html", "rb") as f:
â€‹            data = f.read()
â€‹        return [data, ]


â€‹    
â€‹    def home():
â€‹        with open("home.html", "rb") as f:
â€‹            data = f.read()
â€‹        return [data, ]


â€‹    
â€‹    # å®šä¹‰ä¸€ä¸ªurlå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»
â€‹    URL_LIST = [
â€‹        ("/index/", index),
â€‹        ("/home/", home),
â€‹    ]


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8'), ])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        url = environ['PATH_INFO']  # å–åˆ°ç”¨æˆ·è¾“å…¥çš„url
â€‹        func = None  # å°†è¦æ‰§è¡Œçš„å‡½æ•°
â€‹        for i in URL_LIST:
â€‹            if i[0] == url:
â€‹                func = i[1]  # å»ä¹‹å‰å®šä¹‰å¥½çš„urlåˆ—è¡¨é‡Œæ‰¾urlåº”è¯¥æ‰§è¡Œçš„å‡½æ•°
â€‹                break
â€‹        if func:  # å¦‚æœèƒ½æ‰¾åˆ°è¦æ‰§è¡Œçš„å‡½æ•°
â€‹            return func()  # è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœ
â€‹        else:
â€‹            return [bytes("404æ²¡æœ‰è¯¥é¡µé¢", encoding="utf8"), ]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

è¿™ç½‘é¡µèƒ½å¤Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†æ˜¯éƒ½æ˜¯é™æ€çš„å•Šã€‚é¡µé¢çš„å†…å®¹éƒ½ä¸ä¼šå˜åŒ–çš„ï¼Œæˆ‘æƒ³è¦çš„æ˜¯åŠ¨æ€ç½‘ç«™ã€‚

æ²¡é—®é¢˜ï¼Œæˆ‘ä¹Ÿæœ‰åŠæ³•è§£å†³ã€‚æˆ‘é€‰æ‹©ä½¿ç”¨å­—ç¬¦ä¸²æ›¿æ¢æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚


â€‹    
â€‹    from wsgiref.simple_server import make_server


â€‹    
â€‹    def index():
â€‹        with open("index.html", "rb") as f:
â€‹            data = f.read()
â€‹        import time
â€‹        time_str = str(time.time())
â€‹        data_str = str(data, encoding="utf8")
â€‹        data_str = data_str.replace("@@a@@", time_str)
â€‹        return [bytes(data_str, encoding="utf8"), ]


â€‹    
â€‹    def home():
â€‹        with open("home.html", "rb") as f:
â€‹            data = f.read()
â€‹        return [data, ]


â€‹    
â€‹    # å®šä¹‰ä¸€ä¸ªurlå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»
â€‹    URL_LIST = [
â€‹        ("/index/", index),
â€‹        ("/home/", home),
â€‹    ]


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8'), ])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        url = environ['PATH_INFO']  # å–åˆ°ç”¨æˆ·è¾“å…¥çš„url
â€‹        func = None  # å°†è¦æ‰§è¡Œçš„å‡½æ•°
â€‹        for i in URL_LIST:
â€‹            if i[0] == url:
â€‹                func = i[1]  # å»ä¹‹å‰å®šä¹‰å¥½çš„urlåˆ—è¡¨é‡Œæ‰¾urlåº”è¯¥æ‰§è¡Œçš„å‡½æ•°
â€‹                break
â€‹        if func:  # å¦‚æœèƒ½æ‰¾åˆ°è¦æ‰§è¡Œçš„å‡½æ•°
â€‹            return func()  # è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœ
â€‹        else:
â€‹            return [bytes("404æ²¡æœ‰è¯¥é¡µé¢", encoding="utf8"), ]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŠ¨æ€ï¼Œæˆ‘å®Œå…¨å¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œç„¶åå»æ›¿æ¢æˆ‘htmlä¸­çš„å¯¹åº”å†…å®¹ï¼Œç„¶åå†å‘é€ç»™æµè§ˆå™¨å®Œæˆæ¸²æŸ“ã€‚ è¿™ä¸ªè¿‡ç¨‹å°±ç›¸å½“äºHTMLæ¨¡æ¿æ¸²æŸ“æ•°æ®ã€‚
æœ¬è´¨ä¸Šå°±æ˜¯HTMLå†…å®¹ä¸­åˆ©ç”¨ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·æ¥æ›¿æ¢è¦å±•ç¤ºçš„æ•°æ®ã€‚ æˆ‘è¿™é‡Œç”¨çš„ç‰¹æ®Šç¬¦å·æ˜¯æˆ‘å®šä¹‰çš„ï¼Œå…¶å®æ¨¡æ¿æ¸²æŸ“æœ‰ä¸ªç°æˆçš„å·¥å…·ï¼š `jinja2`

ä¸‹è½½jinja2:


â€‹    
â€‹    pip install jinja2

![](https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif)![](https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif)


â€‹    
â€‹    <!DOCTYPE html>
â€‹    <html lang="zh-CN">
â€‹    <head>
â€‹      <meta charset="UTF-8">
â€‹      <meta http-equiv="x-ua-compatible" content="IE=edge">
â€‹      <meta name="viewport" content="width=device-width, initial-scale=1">
â€‹      <title>Title</title>
â€‹    </head>
â€‹    <body>
â€‹        <h1>å§“åï¼š{{name}}</h1>
â€‹        <h1>çˆ±å¥½ï¼š</h1>
â€‹        <ul>
â€‹            {% for hobby in hobby_list %}
â€‹            <li>{{hobby}}</li>
â€‹            {% endfor %}
â€‹        </ul>
â€‹    </body>
â€‹    </html>

index2.htmlæ–‡ä»¶

ä½¿ç”¨jinja2æ¸²æŸ“index2.htmlæ–‡ä»¶ï¼š


â€‹    
â€‹    from wsgiref.simple_server import make_server
â€‹    from jinja2 import Template


â€‹    
â€‹    def index():
â€‹        with open("index2.html", "r") as f:
â€‹            data = f.read()
â€‹        template = Template(data)  # ç”Ÿæˆæ¨¡æ¿æ–‡ä»¶
â€‹        ret = template.render({"name": "Alex", "hobby_list": ["çƒ«å¤´", "æ³¡å§"]})  # æŠŠæ•°æ®å¡«å……åˆ°æ¨¡æ¿é‡Œé¢
â€‹        return [bytes(ret, encoding="utf8"), ]


â€‹    
â€‹    def home():
â€‹        with open("home.html", "rb") as f:
â€‹            data = f.read()
â€‹        return [data, ]


â€‹    
â€‹    # å®šä¹‰ä¸€ä¸ªurlå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»
â€‹    URL_LIST = [
â€‹        ("/index/", index),
â€‹        ("/home/", home),
â€‹    ]


â€‹    
â€‹    def run_server(environ, start_response):
â€‹        start_response('200 OK', [('Content-Type', 'text/html;charset=utf8'), ])  # è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ç å’Œå¤´ä¿¡æ¯
â€‹        url = environ['PATH_INFO']  # å–åˆ°ç”¨æˆ·è¾“å…¥çš„url
â€‹        func = None  # å°†è¦æ‰§è¡Œçš„å‡½æ•°
â€‹        for i in URL_LIST:
â€‹            if i[0] == url:
â€‹                func = i[1]  # å»ä¹‹å‰å®šä¹‰å¥½çš„urlåˆ—è¡¨é‡Œæ‰¾urlåº”è¯¥æ‰§è¡Œçš„å‡½æ•°
â€‹                break
â€‹        if func:  # å¦‚æœèƒ½æ‰¾åˆ°è¦æ‰§è¡Œçš„å‡½æ•°
â€‹            return func()  # è¿”å›å‡½æ•°çš„æ‰§è¡Œç»“æœ
â€‹        else:
â€‹            return [bytes("404æ²¡æœ‰è¯¥é¡µé¢", encoding="utf8"), ]


â€‹    
â€‹    if __name__ == '__main__':
â€‹        httpd = make_server('', 8000, run_server)
â€‹        print("Serving HTTP on port 8000...")
â€‹        httpd.serve_forever()

ç°åœ¨çš„æ•°æ®æ˜¯æˆ‘ä»¬è‡ªå·±æ‰‹å†™çš„ï¼Œé‚£å¯ä¸å¯ä»¥ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œæ¥å¡«å……é¡µé¢å‘¢ï¼Ÿ

ä½¿ç”¨pymysqlè¿æ¥æ•°æ®åº“ï¼š


â€‹    
â€‹    conn = pymysql.connect(host="127.0.0.1", port=3306, user="root", passwd="xxx", db="xxx", charset="utf8")
â€‹    cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)
â€‹    cursor.execute("select name, age, department_id from userinfo")
â€‹    user_list = cursor.fetchall()
â€‹    cursor.close()
â€‹    conn.close()

åˆ›å»ºä¸€ä¸ªæµ‹è¯•çš„userè¡¨ï¼š


â€‹    
â€‹    CREATE TABLE user(
â€‹      id int auto_increment PRIMARY KEY,
â€‹      name CHAR(10) NOT NULL,
â€‹      hobby CHAR(20) NOT NULL
â€‹    )engine=innodb DEFAULT charset=UTF8;

æ¨¡æ¿çš„åŸç†å°±æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæˆ‘ä»¬åªè¦åœ¨HTMLé¡µé¢ä¸­éµå¾ªjinja2çš„è¯­æ³•è§„åˆ™å†™ä¸Šï¼Œå…¶å†…éƒ¨å°±ä¼šæŒ‰ç…§æŒ‡å®šçš„è¯­æ³•è¿›è¡Œç›¸åº”çš„æ›¿æ¢ï¼Œä»è€Œè¾¾åˆ°åŠ¨æ€çš„è¿”å›å†…å®¹ã€‚

## Django

[Djangoå®˜ç½‘ä¸‹è½½é¡µé¢](https://www.djangoproject.com/download/)

### å®‰è£…ï¼ˆå®‰è£…æœ€æ–°LTSç‰ˆï¼‰ï¼š


â€‹    
â€‹    pip3 install django==1.11.9

### åˆ›å»ºä¸€ä¸ªdjangoé¡¹ç›®ï¼š

ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º"mysite"çš„Django é¡¹ç›®ï¼š


â€‹    
â€‹    django-admin startproject mysite

### ç›®å½•ä»‹ç»ï¼š


â€‹    
â€‹    mysite/
â€‹    â”œâ”€â”€ manage.py  # ç®¡ç†æ–‡ä»¶
â€‹    â””â”€â”€ mysite  # é¡¹ç›®ç›®å½•
â€‹        â”œâ”€â”€ __init__.py
â€‹        â”œâ”€â”€ settings.py  # é…ç½®
â€‹        â”œâ”€â”€ urls.py  # è·¯ç”± --> URLå’Œå‡½æ•°çš„å¯¹åº”å…³ç³»
â€‹        â””â”€â”€ wsgi.py  # runserverå‘½ä»¤å°±ä½¿ç”¨wsgirefæ¨¡å—åšç®€å•çš„web server

### è¿è¡ŒDjangoé¡¹ç›®ï¼š


â€‹    
â€‹    python manage.py runserver 127.0.0.1:8000

### æ¨¡æ¿æ–‡ä»¶é…ç½®ï¼š


â€‹    
â€‹    TEMPLATES = [
â€‹        {
â€‹            'BACKEND': 'django.template.backends.django.DjangoTemplates',
â€‹            'DIRS': [os.path.join(BASE_DIR, "template")],  # templateæ–‡ä»¶å¤¹ä½ç½®
â€‹            'APP_DIRS': True,
â€‹            'OPTIONS': {
â€‹                'context_processors': [
â€‹                    'django.template.context_processors.debug',
â€‹                    'django.template.context_processors.request',
â€‹                    'django.contrib.auth.context_processors.auth',
â€‹                    'django.contrib.messages.context_processors.messages',
â€‹                ],
â€‹            },
â€‹        },
â€‹    ]

### é™æ€æ–‡ä»¶é…ç½®ï¼š


â€‹    
â€‹    STATIC_URL = '/static/'  # HTMLä¸­ä½¿ç”¨çš„é™æ€æ–‡ä»¶å¤¹å‰ç¼€
â€‹    STATICFILES_DIRS = [
â€‹        os.path.join(BASE_DIR, "static"),  # é™æ€æ–‡ä»¶å­˜æ”¾ä½ç½®
â€‹    ]

**çœ‹ä¸æ˜ç™½ï¼Ÿæœ‰å›¾æœ‰çœŸç›¸ï¼š**

**![](https://images2017.cnblogs.com/blog/867021/201801/867021-20180110190001816-1349372864.png)**

**åˆšå¼€å§‹å­¦ä¹ æ—¶å¯åœ¨é…ç½®æ–‡ä»¶ä¸­æš‚æ—¶ç¦ç”¨csrfä¸­é—´ä»¶ï¼Œæ–¹ä¾¿è¡¨å•æäº¤æµ‹è¯•ã€‚**


â€‹    
â€‹    MIDDLEWARE = [
â€‹         'django.middleware.security.SecurityMiddleware',
â€‹        'django.contrib.sessions.middleware.SessionMiddleware',
â€‹        'django.middleware.common.CommonMiddleware',
â€‹        # 'django.middleware.csrf.CsrfViewMiddleware',
â€‹        'django.contrib.auth.middleware.AuthenticationMiddleware',
â€‹        'django.contrib.messages.middleware.MessageMiddleware',
â€‹        'django.middleware.clickjacking.XFrameOptionsMiddleware',
â€‹    ]

## DjangoåŸºç¡€å¿…å¤‡ä¸‰ä»¶å¥—ï¼š


â€‹    
â€‹    from django.shortcuts import HttpResponse, render, redirect

### HttpResponse

å†…éƒ¨ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿”å›ç»™æµè§ˆå™¨ã€‚

ä¾‹å¦‚ï¼š


â€‹    
â€‹    def index(request):
â€‹        # ä¸šåŠ¡é€»è¾‘ä»£ç 
â€‹        return HttpResponse("OK")

### render

é™¤requestå‚æ•°å¤–è¿˜æ¥å—ä¸€ä¸ªå¾…æ¸²æŸ“çš„æ¨¡æ¿æ–‡ä»¶å’Œä¸€ä¸ªä¿å­˜å…·ä½“æ•°æ®çš„å­—å…¸å‚æ•°ã€‚

å°†æ•°æ®å¡«å……è¿›æ¨¡æ¿æ–‡ä»¶ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚ï¼ˆç±»ä¼¼äºæˆ‘ä»¬ä¸Šé¢ç”¨åˆ°çš„jinja2ï¼‰

ä¾‹å¦‚ï¼š


â€‹    
â€‹    def index(request):
â€‹        # ä¸šåŠ¡é€»è¾‘ä»£ç 
â€‹        return render(request, "index.html", {"name": "alex", "hobby": ["çƒ«å¤´", "æ³¡å§"]})

### redirect

æ¥å—ä¸€ä¸ªURLå‚æ•°ï¼Œè¡¨ç¤ºè·³è½¬åˆ°æŒ‡å®šçš„URLã€‚

ä¾‹å¦‚ï¼š


â€‹    
â€‹    def index(request):
â€‹        # ä¸šåŠ¡é€»è¾‘ä»£ç 
â€‹        return redirect("/home/")

## è¯¾åç»ƒä¹ ï¼š

Djangoç‰ˆç™»å½•



## å¯åŠ¨DjangoæŠ¥é”™ï¼š

Django å¯åŠ¨æ—¶æŠ¥é”™ UnicodeEncodeError ...

æŠ¥è¿™ä¸ªé”™è¯¯é€šå¸¸æ˜¯å› ä¸ºè®¡ç®—æœºåä¸ºä¸­æ–‡ï¼Œæ”¹æˆè‹±æ–‡çš„è®¡ç®—æœºåé‡å¯ä¸‹ç”µè„‘å°±å¯ä»¥äº†ã€‚










